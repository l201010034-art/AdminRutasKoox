const _0x43311e=_0x58e7;(function(_0x49d078,_0x37c6cf){const _0x16d212=_0x58e7,_0x23d428=_0x49d078();while(!![]){try{const _0x6ffe73=-parseInt(_0x16d212(0x10d))/0x1*(parseInt(_0x16d212(0xd8))/0x2)+-parseInt(_0x16d212(0x104))/0x3+parseInt(_0x16d212(0x101))/0x4+parseInt(_0x16d212(0xf6))/0x5+-parseInt(_0x16d212(0x122))/0x6*(-parseInt(_0x16d212(0xfc))/0x7)+-parseInt(_0x16d212(0x10b))/0x8+parseInt(_0x16d212(0xff))/0x9*(parseInt(_0x16d212(0xde))/0xa);if(_0x6ffe73===_0x37c6cf)break;else _0x23d428['push'](_0x23d428['shift']());}catch(_0x46e661){_0x23d428['push'](_0x23d428['shift']());}}}(_0x4bd9,0xb185a));let mapaFlota=null;const marcadoresChoferes={};let datosConductoresCache={},unsubscribeGPS=null,unsubscribeReportes=null,layerGroupReportes=null;const COLECCION_REPORTES='alertas',iconoBusAdmin=L['divIcon']({'className':_0x43311e(0x111),'html':_0x43311e(0x110),'iconSize':[0x1e,0x1e],'iconAnchor':[0xf,0xf]}),iconoReporte=L[_0x43311e(0x120)]({'className':_0x43311e(0x129),'html':'<div\x20style=\x22background:#ef4444;\x20color:white;\x20width:28px;\x20height:28px;\x20border-radius:50%;\x20display:flex;\x20align-items:center;\x20justify-content:center;\x20border:2px\x20solid\x20white;\x20box-shadow:0\x202px\x204px\x20rgba(0,0,0,0.2);\x20animation:\x20pulse\x202s\x20infinite;\x22><i\x20class=\x22ri-alarm-warning-fill\x22></i></div>','iconSize':[0x1c,0x1c],'iconAnchor':[0xe,0xe]});function _0x58e7(_0x462d85,_0x59936c){_0x462d85=_0x462d85-0xd4;const _0x4bd9f6=_0x4bd9();let _0x58e78d=_0x4bd9f6[_0x462d85];return _0x58e78d;}function inicializarMapaFlota(){const _0x1a008d=_0x43311e;if(mapaFlota)return;mapaFlota=L['map'](_0x1a008d(0x10c))[_0x1a008d(0x106)]([19.8301,-90.5349],0xd),L['tileLayer'](_0x1a008d(0xdd),{'attribution':_0x1a008d(0x11d),'maxZoom':0x14})[_0x1a008d(0x115)](mapaFlota),layerGroupReportes=L[_0x1a008d(0xee)]()['addTo'](mapaFlota),firestoreFlota[_0x1a008d(0xdf)](_0x1a008d(0x10f))['onSnapshot'](_0x371589=>{const _0x3e65a3=_0x1a008d,_0x28aad3={};_0x371589[_0x3e65a3(0xf0)](_0xb69839=>_0x28aad3[_0xb69839['id']]=_0xb69839['data']()),datosConductoresCache=_0x28aad3;}),unsubscribeGPS=firestoreFlota[_0x1a008d(0xdf)](_0x1a008d(0x12a))['onSnapshot'](_0x41bec3=>{const _0xda0e80=_0x1a008d;actualizarContadorBuses(_0x41bec3['size']),_0x41bec3[_0xda0e80(0xf0)](_0x1ffe7b=>{const _0x51f160=_0xda0e80,_0x56cadf=_0x1ffe7b['data']();if(!_0x56cadf[_0x51f160(0xf1)]||!_0x56cadf['lng'])return;const _0x379065=_0x56cadf[_0x51f160(0xeb)]||'Sin\x20Ruta',_0x2a9b37=parseFloat(_0x56cadf[_0x51f160(0xd7)]||0x0)[_0x51f160(0xf8)](0x1),_0x25a890=_0x56cadf[_0x51f160(0x128)]||_0x1ffe7b['id'],_0x1c615f=datosConductoresCache[_0x56cadf[_0x51f160(0x124)]]||{},_0x252c4b=_0x1c615f['nombre']||'Chofer\x20'+(_0x56cadf[_0x51f160(0x124)]?_0x56cadf[_0x51f160(0x124)][_0x51f160(0xe8)](0x0,0x4):_0x51f160(0x103)),_0x5b3abb=_0x51f160(0x12b)+_0x25a890+_0x51f160(0x127)+_0x379065+_0x51f160(0x123)+_0x252c4b+_0x51f160(0xea)+_0x2a9b37+_0x51f160(0xe4);marcadoresChoferes[_0x25a890]?marcadoresChoferes[_0x25a890][_0x51f160(0xe5)]([_0x56cadf[_0x51f160(0xf1)],_0x56cadf[_0x51f160(0x119)]])[_0x51f160(0xf7)](_0x5b3abb):marcadoresChoferes[_0x25a890]=L[_0x51f160(0x113)]([_0x56cadf[_0x51f160(0xf1)],_0x56cadf[_0x51f160(0x119)]],{'icon':iconoBusAdmin})[_0x51f160(0x115)](mapaFlota)[_0x51f160(0xfb)](_0x5b3abb);});}),dbMantenimiento[_0x1a008d(0xdb)]('alertas')['on'](_0x1a008d(0xda),_0x210244=>{renderizarAlertasCriticas(_0x210244['val']());});}window[_0x43311e(0xf5)]=function(_0x122065){const _0x460249=_0x43311e;if(!mapaFlota||!layerGroupReportes)return;if(_0x122065)unsubscribeReportes=firestore[_0x460249(0xdf)](COLECCION_REPORTES)[_0x460249(0xe9)](_0x369505=>{const _0x5c48eb=_0x460249;layerGroupReportes[_0x5c48eb(0xef)]();let _0x43f019=0x0;_0x369505[_0x5c48eb(0xf0)](_0x109df1=>{const _0x4d15c9=_0x5c48eb,_0x1a4af7=_0x109df1[_0x4d15c9(0x105)]();if(_0x1a4af7[_0x4d15c9(0xf1)]&&_0x1a4af7[_0x4d15c9(0x119)]){let _0x21cde3='--:--';_0x1a4af7[_0x4d15c9(0xe1)]&&_0x1a4af7[_0x4d15c9(0xe1)]['toDate']&&(_0x21cde3=new Date(_0x1a4af7[_0x4d15c9(0xe1)]['toDate']())[_0x4d15c9(0x11a)]());const _0xd7753f=_0x4d15c9(0x11c)+(_0x1a4af7[_0x4d15c9(0xd5)]||_0x4d15c9(0x112))+_0x4d15c9(0xfe)+_0x21cde3+_0x4d15c9(0xe0)+(_0x1a4af7[_0x4d15c9(0x10e)]||'')+_0x4d15c9(0x11f)+_0x109df1['id']+_0x4d15c9(0xf3);L['marker']([_0x1a4af7[_0x4d15c9(0xf1)],_0x1a4af7['lng']],{'icon':iconoReporte})['addTo'](layerGroupReportes)[_0x4d15c9(0xfb)](_0xd7753f),_0x43f019++;}});const _0xe82e82=document[_0x5c48eb(0xf4)](_0x5c48eb(0x117));if(_0xe82e82)_0xe82e82['innerText']=_0x43f019;});else{if(unsubscribeReportes)unsubscribeReportes();layerGroupReportes['clearLayers']();}},window[_0x43311e(0x114)]=function(_0x4d0b32){const _0xbd1382=_0x43311e;if(!confirm(_0xbd1382(0x126)))return;firestore[_0xbd1382(0xdf)](COLECCION_REPORTES)['doc'](_0x4d0b32)['delete']()[_0xbd1382(0xfa)](_0x415c64=>console[_0xbd1382(0xd4)](_0x415c64));};function renderizarAlertasCriticas(_0x172320){const _0x346845=_0x43311e,_0xcf50b9=document[_0x346845(0xf4)]('panel-alertas-criticas');if(!_0x172320){_0xcf50b9[_0x346845(0xd9)]['display']=_0x346845(0x11b);return;}const _0x583430=Date[_0x346845(0xf2)](),_0x5ad5d2=Object[_0x346845(0x100)](_0x172320)[_0x346845(0x102)](_0x10cde2=>({'ruta':_0x10cde2,..._0x172320[_0x10cde2]})),_0x3df3fe=_0x5ad5d2[_0x346845(0xe2)](_0xa75304=>_0xa75304[_0x346845(0x125)]>_0x583430);if(_0x3df3fe[_0x346845(0x108)]===0x0){_0xcf50b9[_0x346845(0xd9)][_0x346845(0x116)]='none';return;}let _0x2cbd66='';_0x3df3fe[_0x346845(0xf0)](_0x11a044=>{const _0x20c3e8=_0x346845,_0x4f24e2=Math['ceil']((_0x11a044[_0x20c3e8(0x125)]-_0x583430)/0xea60);_0x2cbd66+=_0x20c3e8(0xe6)+_0x11a044[_0x20c3e8(0xf9)]+_0x20c3e8(0x107)+_0x11a044[_0x20c3e8(0xe3)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22alerta-footer\x22>Expira\x20en\x20'+_0x4f24e2+_0x20c3e8(0xed)+_0x11a044['ruta']+_0x20c3e8(0xd6);}),_0xcf50b9[_0x346845(0xec)]=_0x2cbd66,_0xcf50b9[_0x346845(0xd9)][_0x346845(0x116)]='block';}window[_0x43311e(0x11e)]=function(_0x4d6839){const _0x42b942=_0x43311e;confirm(_0x42b942(0x10a)+_0x4d6839+'?')&&dbMantenimiento['ref']('alertas')[_0x42b942(0x109)](_0x4d6839)[_0x42b942(0xe7)]();};function actualizarContadorBuses(_0x9a5eeb){const _0x3801ff=_0x43311e,_0x5b2138=document[_0x3801ff(0xf4)](_0x3801ff(0x118));if(_0x5b2138)_0x5b2138[_0x3801ff(0xdc)]=_0x9a5eeb;}function _0x4bd9(){const _0x138ab7=['lng','toLocaleTimeString','none','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:center;\x20min-width:150px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<strong\x20style=\x22color:#ef4444;\x20font-size:1.1em;\x22>ðŸš¨\x20','&copy;\x20OpenStreetMap\x20&copy;\x20CARTO','borrarAlertaRuta','\x22</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style=\x22margin:5px\x200;\x20border:0;\x20border-top:1px\x20solid\x20#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22resolverReporte(\x27','divIcon','\x0a\x20\x20\x20\x20.badge-success\x20{\x20background:#d1fae5;\x20color:#065f46;\x20padding:2px\x206px;\x20border-radius:4px;\x20font-size:0.8em;\x20font-weight:bold;\x20}\x0a\x20\x20\x20\x20.alerta-card-flotante\x20{\x20background:\x20white;\x20border-left:\x205px\x20solid\x20#ef4444;\x20border-radius:\x208px;\x20box-shadow:\x200\x204px\x2015px\x20rgba(0,0,0,0.2);\x20margin-bottom:\x2010px;\x20overflow:\x20hidden;\x20animation:\x20slideIn\x200.3s\x20ease-out;\x20}\x0a\x20\x20\x20\x20.alerta-header\x20{\x20background:\x20#fee2e2;\x20color:\x20#991b1b;\x20padding:\x208px\x2012px;\x20font-weight:\x20bold;\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x208px;\x20}\x0a\x20\x20\x20\x20.alerta-body\x20{\x20padding:\x2010px\x2012px;\x20font-size:\x200.9rem;\x20}\x0a\x20\x20\x20\x20.alerta-footer\x20{\x20padding:\x208px\x2012px;\x20background:\x20#f8fafc;\x20font-size:\x200.75rem;\x20color:\x20#64748b;\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20}\x0a\x20\x20\x20\x20.btn-borrar-alerta\x20{\x20background:\x20#cbd5e1;\x20border:\x20none;\x20padding:\x202px\x208px;\x20border-radius:\x204px;\x20cursor:\x20pointer;\x20font-size:\x200.75rem;\x20}\x0a\x20\x20\x20\x20.btn-borrar-alerta:hover\x20{\x20background:\x20#94a3b8;\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20@keyframes\x20slideIn\x20{\x20from\x20{\x20transform:\x20translateX(-20px);\x20opacity:\x200;\x20}\x20to\x20{\x20transform:\x20translateX(0);\x20opacity:\x201;\x20}\x20}\x0a\x20\x20\x20\x20@keyframes\x20pulse\x20{\x200%\x20{\x20box-shadow:\x200\x200\x200\x200\x20rgba(239,\x2068,\x2068,\x200.7);\x20}\x2070%\x20{\x20box-shadow:\x200\x200\x200\x2010px\x20rgba(239,\x2068,\x2068,\x200);\x20}\x20100%\x20{\x20box-shadow:\x200\x200\x200\x200\x20rgba(239,\x2068,\x2068,\x200);\x20}\x20}\x0a','6535032DezLJc','</span><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','driverId','expiraEn','Â¿Marcar\x20alerta\x20como\x20atendida?','</b><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22badge-success\x22>','unitId','custom-report-icon','live_locations','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22text-align:center;\x20min-width:140px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b\x20style=\x22color:#0056b3;\x22>Unidad\x20','error','tipo','\x27)\x22\x20class=\x22btn-borrar-alerta\x22>Resolver</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','speed','60620LRhnwF','style','value','ref','innerText','https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png','10843090pKMuxW','collection','</small><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin:5px\x200;\x20font-style:italic;\x22>\x22','timestamp','filter','mensaje','\x20km/h</b>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>','setLatLng','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22alerta-card-flotante\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22alerta-header\x22><i\x20class=\x22ri-alarm-warning-fill\x22></i>\x20','remove','substring','onSnapshot','</small><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style=\x22margin:5px\x200;\x20border-color:#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<b>','routeId','innerHTML','\x20min\x20<button\x20onclick=\x22borrarAlertaRuta(\x27','layerGroup','clearLayers','forEach','lat','now','\x27)\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20style=\x22background:#10b981;\x20color:white;\x20border:none;\x20padding:5px\x2010px;\x20border-radius:5px;\x20cursor:pointer;\x20width:100%;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20âœ…\x20Resolver\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getElementById','toggleCapaReportes','5818865YFGBXY','setPopupContent','toFixed','ruta','catch','bindPopup','7WfULmh','head','</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small>','9LKULfS','keys','1114964UOpIgV','map','Unknown','1915944GxOeLD','data','setView','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22alerta-body\x22>','length','child','Â¿Resolver\x20alerta\x20de\x20','6847656zLOERl','map-admin','46sPBSvz','comentario','conductores','<div\x20style=\x22background:#0056b3;\x20color:white;\x20width:30px;\x20height:30px;\x20border-radius:50%;\x20display:flex;\x20align-items:center;\x20justify-content:center;\x20border:2px\x20solid\x20white;\x20box-shadow:0\x203px\x205px\x20rgba(0,0,0,0.3);\x22><i\x20class=\x22ri-bus-fill\x22></i></div>','custom-bus-icon','Alerta','marker','resolverReporte','addTo','display','count-reports','count-buses'];_0x4bd9=function(){return _0x138ab7;};return _0x4bd9();}const estilos=document['createElement'](_0x43311e(0xd9));estilos[_0x43311e(0xec)]=_0x43311e(0x121),document[_0x43311e(0xfd)]['appendChild'](estilos);
const _0x562cf9=_0x1697;function _0x3242(){const _0x5e1d34=['timestamp','orderBy','removeChild','telemetria_rutaskoox_','tabla-telemetria-body','status','toDate','push','6126xLLbVx','getContext','length','ðŸ“Š\x20Inicializando\x20AnalÃ­tica...','chart-tiempos','createElement','lng','.csv','destroy','lat','602516HUhTOJ','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20','7kjrNup','6xXsNft','getElementById','chart-flota','forEach','ruta','velocidad','descargarReporteCSV','turnoFin','4ZahFHr','getTime','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:10px;\x22>','onSnapshot','keys','#ff9900','now','collection','unitId','click','bar','body','href','log','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20style=\x22border-bottom:1px\x20solid\x20#eee;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:10px;\x22><b>','appendChild','#10b981','values','---','chart-velocidad','live_locations','data','1200924LoDZZR','No\x20hay\x20datos\x20para\x20exportar\x20aÃºn.','4880865FitDSN','40oXZjoV','#0056b3','limit','toFixed','turnoInicio','Sin\x20Asignar','</b></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:10px;\x22><span\x20class=\x22badge-success\x22>','4342968RyCBqr','</span></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:10px;\x22>','speed','Minutos','Unknown','Tiempo\x20Promedio\x20por\x20Turno\x20(Minutos)','setAttribute','reduce','data:text/csv;charset=utf-8,Unidad,Ruta,Velocidad,Estado,Lat,Lng,Fecha\x0a','5549656ydBnNf','3386405NULczO','lastUpdate'];_0x3242=function(){return _0x5e1d34;};return _0x3242();}(function(_0x20e2d2,_0x557d63){const _0x5a5cbe=_0x1697,_0x2cf11b=_0x20e2d2();while(!![]){try{const _0x516e06=parseInt(_0x5a5cbe(0x1b0))/0x1+-parseInt(_0x5a5cbe(0x1a6))/0x2*(-parseInt(_0x5a5cbe(0x1b3))/0x3)+-parseInt(_0x5a5cbe(0x1bb))/0x4*(-parseInt(_0x5a5cbe(0x1d3))/0x5)+parseInt(_0x5a5cbe(0x192))/0x6+-parseInt(_0x5a5cbe(0x1b2))/0x7*(parseInt(_0x5a5cbe(0x19b))/0x8)+parseInt(_0x5a5cbe(0x1d1))/0x9+-parseInt(_0x5a5cbe(0x1d4))/0xa*(parseInt(_0x5a5cbe(0x19c))/0xb);if(_0x516e06===_0x557d63)break;else _0x2cf11b['push'](_0x2cf11b['shift']());}catch(_0x3c4458){_0x2cf11b['push'](_0x2cf11b['shift']());}}}(_0x3242,0x7e358));let chartFlotaInstance=null,chartVelocidadInstance=null,chartTiemposInstance=null,datosTelemetriaCache=[];function _0x1697(_0x686be4,_0x4b4ece){_0x686be4=_0x686be4-0x18c;const _0x3242eb=_0x3242();let _0x16975e=_0x3242eb[_0x686be4];return _0x16975e;}function inicializarAnalitica(){const _0x455b78=_0x1697;console[_0x455b78(0x1c8)](_0x455b78(0x1a9)),firestoreFlota[_0x455b78(0x1c2)](_0x455b78(0x1cf))[_0x455b78(0x1be)](_0x10c32d=>{const _0x257a23=_0x455b78,_0x27e8b2=[];_0x10c32d['forEach'](_0x17329a=>_0x27e8b2[_0x257a23(0x1a5)]({'id':_0x17329a['id'],..._0x17329a[_0x257a23(0x1d0)]()})),procesarDatosFlota(_0x27e8b2);}),firestoreFlota[_0x455b78(0x1c2)]('turnos_terminados')[_0x455b78(0x19f)](_0x455b78(0x1ba),'desc')[_0x455b78(0x18d)](0x32)[_0x455b78(0x1be)](procesarTiemposTurnos);}function procesarDatosFlota(_0x4fb045){const _0x3582d6=_0x1697,_0x547c95={},_0x374ad4={},_0x2cc689=[];_0x4fb045[_0x3582d6(0x1b6)](_0x4d16f4=>{const _0x220df6=_0x3582d6,_0x2acb1f=_0x4d16f4['routeId']||_0x220df6(0x190),_0x495fa6=parseFloat(_0x4d16f4[_0x220df6(0x194)]||0x0),_0x24a515=_0x4d16f4[_0x220df6(0x1c3)]||_0x4d16f4['id'],_0x36b8b3=_0x4d16f4[_0x220df6(0x1a3)]||_0x220df6(0x196);let _0x101b6a=_0x220df6(0x1cd);_0x4d16f4[_0x220df6(0x19d)]&&_0x4d16f4[_0x220df6(0x19d)][_0x220df6(0x1a4)]&&(_0x101b6a=_0x4d16f4['lastUpdate']['toDate']()[_0x220df6(0x1bc)]());if(!_0x547c95[_0x2acb1f])_0x547c95[_0x2acb1f]=0x0;_0x547c95[_0x2acb1f]++;if(!_0x374ad4[_0x2acb1f])_0x374ad4[_0x2acb1f]=[];_0x374ad4[_0x2acb1f][_0x220df6(0x1a5)](_0x495fa6),_0x2cc689[_0x220df6(0x1a5)]({'id':_0x24a515,'ruta':_0x2acb1f,'velocidad':_0x495fa6[_0x220df6(0x18e)](0x2),'estado':_0x36b8b3,'lat':_0x4d16f4[_0x220df6(0x1af)],'lng':_0x4d16f4[_0x220df6(0x1ac)],'timestamp':_0x101b6a});}),datosTelemetriaCache=_0x2cc689;const _0x24a5e9=Object[_0x3582d6(0x1bf)](_0x547c95),_0x435d87=_0x24a5e9['map'](_0x3396e7=>{const _0x3bcd8f=_0x3582d6,_0x5465c9=_0x374ad4[_0x3396e7];return(_0x5465c9[_0x3bcd8f(0x199)]((_0x75f479,_0x5dee40)=>_0x75f479+_0x5dee40,0x0)/_0x5465c9['length'])['toFixed'](0x1);});renderizarChartFlota(_0x24a5e9,Object[_0x3582d6(0x1cc)](_0x547c95)),renderizarChartVelocidad(_0x24a5e9,_0x435d87),actualizarTablaTelemetria(_0x2cc689);}function procesarTiemposTurnos(_0x2c9190){const _0x4875e5=_0x1697,_0x1d7564={};_0x2c9190[_0x4875e5(0x1b6)](_0x5431b9=>{const _0x18299c=_0x4875e5,_0x47bb27=_0x5431b9[_0x18299c(0x1d0)]();if(_0x47bb27[_0x18299c(0x18f)]&&_0x47bb27[_0x18299c(0x1ba)]&&_0x47bb27['routeId']){const _0x2c11e5=_0x47bb27['turnoInicio'][_0x18299c(0x1a4)](),_0x4b2012=_0x47bb27[_0x18299c(0x1ba)][_0x18299c(0x1a4)](),_0x37390c=(_0x4b2012-_0x2c11e5)/0x3e8/0x3c;if(_0x37390c>0x5&&_0x37390c<0x258){const _0x9ec101=_0x47bb27['routeId'];if(!_0x1d7564[_0x9ec101])_0x1d7564[_0x9ec101]=[];_0x1d7564[_0x9ec101]['push'](_0x37390c);}}});const _0x3345de=Object['keys'](_0x1d7564),_0x58325d=_0x3345de['map'](_0x4303fa=>{const _0x29f494=_0x4875e5,_0x45dbbb=_0x1d7564[_0x4303fa],_0x3abc51=_0x45dbbb[_0x29f494(0x199)]((_0xb4a443,_0x3063ff)=>_0xb4a443+_0x3063ff,0x0);return(_0x3abc51/_0x45dbbb[_0x29f494(0x1a8)])[_0x29f494(0x18e)](0x0);});renderizarChartTiempos(_0x3345de,_0x58325d);}function renderizarChartFlota(_0x410017,_0x3a5bd8){const _0x23cbdc=_0x1697,_0x19a121=document[_0x23cbdc(0x1b4)](_0x23cbdc(0x1b5));if(!_0x19a121)return;if(chartFlotaInstance)chartFlotaInstance[_0x23cbdc(0x1ae)]();chartFlotaInstance=new Chart(_0x19a121[_0x23cbdc(0x1a7)]('2d'),{'type':'bar','data':{'labels':_0x410017,'datasets':[{'label':'Unidades\x20Activas','data':_0x3a5bd8,'backgroundColor':_0x23cbdc(0x18c),'borderRadius':0x5}]},'options':{'responsive':!![]}});}function renderizarChartVelocidad(_0x261af4,_0x154f18){const _0x221270=_0x1697,_0x414a9f=document[_0x221270(0x1b4)](_0x221270(0x1ce));if(!_0x414a9f)return;if(chartVelocidadInstance)chartVelocidadInstance[_0x221270(0x1ae)]();chartVelocidadInstance=new Chart(_0x414a9f[_0x221270(0x1a7)]('2d'),{'type':'line','data':{'labels':_0x261af4,'datasets':[{'label':'Velocidad\x20Promedio\x20(km/h)','data':_0x154f18,'borderColor':_0x221270(0x1c0),'backgroundColor':'rgba(255,\x20153,\x200,\x200.2)','tension':0.4,'fill':!![]}]},'options':{'responsive':!![]}});}function renderizarChartTiempos(_0x47a228,_0x51afcf){const _0x2a7fe9=_0x1697,_0x362e7d=document[_0x2a7fe9(0x1b4)](_0x2a7fe9(0x1aa));if(!_0x362e7d)return;if(chartTiemposInstance)chartTiemposInstance['destroy']();chartTiemposInstance=new Chart(_0x362e7d[_0x2a7fe9(0x1a7)]('2d'),{'type':_0x2a7fe9(0x1c5),'data':{'labels':_0x47a228,'datasets':[{'label':_0x2a7fe9(0x197),'data':_0x51afcf,'backgroundColor':_0x2a7fe9(0x1cb),'borderRadius':0x5}]},'options':{'responsive':!![],'indexAxis':'y','scales':{'x':{'beginAtZero':!![],'title':{'display':!![],'text':_0x2a7fe9(0x195)}}}}});}function actualizarTablaTelemetria(_0x2ba17b){const _0x3a1a4b=_0x1697,_0x4a91ac=document[_0x3a1a4b(0x1b4)](_0x3a1a4b(0x1a2));if(!_0x4a91ac)return;_0x4a91ac['innerHTML']='',_0x2ba17b['forEach'](_0xff8c15=>{const _0x5c543a=_0x3a1a4b,_0x16e70f=_0xff8c15['timestamp']!=='---'?new Date(_0xff8c15[_0x5c543a(0x19e)])['toLocaleTimeString']():'---',_0x232398=_0x5c543a(0x1c9)+_0xff8c15['id']+_0x5c543a(0x191)+_0xff8c15[_0x5c543a(0x1b7)]+_0x5c543a(0x193)+_0xff8c15[_0x5c543a(0x1b8)]+_0x5c543a(0x1bd)+_0xff8c15['estado']+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20style=\x22padding:10px;\x20color:#999;\x20font-size:0.8rem;\x22>'+_0x16e70f+_0x5c543a(0x1b1);_0x4a91ac['innerHTML']+=_0x232398;});}window[_0x562cf9(0x1b9)]=function(){const _0x52ed40=_0x562cf9;if(!datosTelemetriaCache[_0x52ed40(0x1a8)]){alert(_0x52ed40(0x1d2));return;}let _0x2ad957=_0x52ed40(0x19a);datosTelemetriaCache[_0x52ed40(0x1b6)](_0x13defe=>{const _0x1a4913=_0x52ed40;_0x2ad957+=_0x13defe['id']+',\x22'+_0x13defe['ruta']+'\x22,'+_0x13defe[_0x1a4913(0x1b8)]+',\x22'+_0x13defe['estado']+'\x22,'+_0x13defe[_0x1a4913(0x1af)]+','+_0x13defe[_0x1a4913(0x1ac)]+',\x22'+_0x13defe[_0x1a4913(0x19e)]+'\x22\x0a';});const _0x196d74=encodeURI(_0x2ad957),_0x9c40d5=document[_0x52ed40(0x1ab)]('a');_0x9c40d5[_0x52ed40(0x198)](_0x52ed40(0x1c7),_0x196d74),_0x9c40d5['setAttribute']('download',_0x52ed40(0x1a1)+Date[_0x52ed40(0x1c1)]()+_0x52ed40(0x1ad)),document[_0x52ed40(0x1c6)][_0x52ed40(0x1ca)](_0x9c40d5),_0x9c40d5[_0x52ed40(0x1c4)](),document[_0x52ed40(0x1c6)][_0x52ed40(0x1a0)](_0x9c40d5);};